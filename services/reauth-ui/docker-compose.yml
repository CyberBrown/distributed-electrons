# Reauth UI - OAuth Reauth Web Interface
# Deploy on Spark (home server) behind Cloudflare Tunnel

services:
  reauth-ui:
    build: .
    container_name: reauth-ui
    restart: unless-stopped
    volumes:
      # Mount credential directories (read-only for status checks)
      - ${HOME}/.claude:/home/node/.claude:ro
      - ${HOME}/.gemini:/home/node/.gemini:ro
    environment:
      # Optional password protection (or rely on CF Access)
      - REAUTH_PASSWORD=${REAUTH_PASSWORD:-}
      # Home directory for credential paths
      - HOME=/home/node
      # Port
      - PORT=8791
      - NODE_ENV=production
    ports:
      # Only bind to localhost - Cloudflare Tunnel handles external access
      - "127.0.0.1:8791:8791"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8791/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
