# Intake Worker Configuration

name = "intake"
main = "index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Worker settings
workers_dev = true

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "de-database"
database_id = "7cff30a0-c974-4ede-b96a-c91dd2f0c870"

# REMOVED â€” Prometheus Phase 1. RequestRouter bypassed by intake-reroute.ts.
# [[durable_objects.bindings]]
# name = "REQUEST_ROUTER"
# class_name = "RequestRouter"
# script_name = "request-router"

# Rate Limiter Durable Object (for intake throttling)
[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"
script_name = "rate-limiter"

# VideoRenderWorkflow (Cloudflare Workflow for video rendering)
[[workflows]]
name = "video-render-workflow"
binding = "VIDEO_RENDER_WORKFLOW"
class_name = "VideoRenderWorkflow"
script_name = "de-workflows"

# CodeExecutionWorkflow (Cloudflare Workflow for code tasks)
[[workflows]]
name = "code-execution-workflow"
binding = "CODE_EXECUTION_WORKFLOW"
class_name = "CodeExecutionWorkflow"
script_name = "de-workflows"

# ProductShippingResearchWorkflow (Cloudflare Workflow for product research)
[[workflows]]
name = "product-shipping-research-workflow"
binding = "PRODUCT_SHIPPING_RESEARCH_WORKFLOW"
class_name = "ProductShippingResearchWorkflow"
script_name = "de-workflows"

# Environment Variables
[vars]
CONFIG_SERVICE_URL = "https://api.distributedelectrons.com"
DEFAULT_INSTANCE_ID = "default"
DE_WORKFLOWS_URL = "https://de-workflows.solamp.workers.dev"
# PASSPHRASE is set via `wrangler secret put PASSPHRASE`

# Custom Domain
[[routes]]
pattern = "intake.distributedelectrons.com"
custom_domain = true
