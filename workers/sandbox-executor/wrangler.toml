# Sandbox Executor Worker Configuration
# Executes Claude Agent SDK tasks in isolated Cloudflare Sandbox containers

name = "sandbox-executor"
main = "src/index.ts"
compatibility_date = "2025-05-06"
compatibility_flags = ["nodejs_compat"]

# Worker settings
workers_dev = true

# Enable observability for debugging
[observability]
enabled = true

# Container configuration for Sandbox SDK
[[containers]]
class_name = "Sandbox"
image = "./Dockerfile"
instance_type = "basic"

# Durable Objects bindings for Sandbox
[durable_objects]
bindings = [
  { name = "Sandbox", class_name = "Sandbox" }
]

# Database migrations for Durable Object
[[migrations]]
tag = "v1"
new_sqlite_classes = ["Sandbox"]

# Environment Variables
[vars]
CONFIG_SERVICE_URL = "https://api.distributedelectrons.com"
MAX_EXECUTION_TIME = "300000"

# Secrets (set with: wrangler secret put <NAME>)
# - ANTHROPIC_API_KEY (for Claude execution in sandbox)
# - CF_AIG_TOKEN (for SDK mode via AI Gateway)
# - GITHUB_PAT (for repo creation - requires 'repo' and 'admin:org' scopes)
# - CLAUDE_RUNNER_URL (on-prem runner URL via Cloudflare Tunnel)
# - RUNNER_SECRET (secret for authenticating with on-prem runner)
# - INTERNAL_API_KEY (for config-service internal API calls)

# Custom Domain (uncomment when ready for production)
# [[routes]]
# pattern = "sandbox.distributedelectrons.com"
# custom_domain = true
