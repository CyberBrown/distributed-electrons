# Sandbox Executor Worker Configuration
# Delegates Claude CLI execution to on-prem runner via Cloudflare Tunnel
# Also supports SDK mode via AI Gateway for lightweight queries

name = "sandbox-executor"
main = "src/index.ts"
compatibility_date = "2025-05-06"
compatibility_flags = ["nodejs_compat"]

# Worker settings
workers_dev = true

# Enable observability for debugging
[observability]
enabled = true

# Environment Variables
[vars]
CONFIG_SERVICE_URL = "https://api.distributedelectrons.com"
MAX_EXECUTION_TIME = "300000"

# AI Gateway Logging Configuration
# Set AI_GATEWAY_LOG_ENABLED = "true" to enable execution logging to AI Gateway
AI_GATEWAY_LOG_ENABLED = "true"

# Secrets (set with: wrangler secret put <NAME>)
# - CF_AIG_TOKEN (for SDK mode via AI Gateway)
# - GITHUB_PAT (for repo creation - requires 'repo' and 'admin:org' scopes)
# - CLAUDE_RUNNER_URL (on-prem Claude runner URL via Cloudflare Tunnel)
# - RUNNER_SECRET (secret for authenticating with on-prem Claude runner)
# - CF_ACCESS_CLIENT_ID (Cloudflare Access service token client ID)
# - CF_ACCESS_CLIENT_SECRET (Cloudflare Access service token secret)
# - GEMINI_RUNNER_URL (on-prem Gemini runner URL via Cloudflare Tunnel)
# - GEMINI_RUNNER_SECRET (secret for authenticating with on-prem Gemini runner)
# - INTERNAL_API_KEY (for config-service internal API calls)
# - AI_GATEWAY_LOG_URL (optional: override for AI Gateway log endpoint)

# Migration to remove Sandbox Durable Object
[[migrations]]
tag = "v2"
deleted_classes = ["Sandbox"]

# Custom Domain (uncomment when ready for production)
# [[routes]]
# pattern = "sandbox.distributedelectrons.com"
# custom_domain = true
